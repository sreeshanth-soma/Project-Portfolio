<!-- index.html -->
{% extends "layout.html" %}

{% block content %}
<div class="container mx-auto p-4">
    <!-- Project Details -->
    <div class="bg-gray-800 text-white rounded-lg shadow-lg p-6 mb-6">
        <h2 class="text-2xl font-bold mb-4">{{ project.text }}</h2>
        <p class="text-gray-400">By: {{ project.user.username }}</p>
        <p class="text-gray-400">Created at: {{ project.created_at }}</p>
        {% if project.image %}
            <img src="{{ project.image.url }}" alt="Project Image" class="w-full h-64 object-cover rounded-lg mt-4">
        {% endif %}
    </div>

    <!-- Comment and Rating Section -->
    {% if request.user != project.user %}  <!-- Only show form to other users -->
    <div class="bg-gray-800 text-white rounded-lg shadow-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">Leave a Comment and Rating</h3>
        <form method="post" action="{% url 'add_comment' project.id %}">
            {% csrf_token %}
            <!-- Star Rating -->
            <div class="flex items-center mb-4">
                <span class="mr-2">Rating:</span>
                <div class="flex space-x-1">
                    {% for i in "12345" %}
                        <button type="button" data-rating="{{ i }}" class="star-rating text-gray-400 hover:text-yellow-400 focus:outline-none">
                            ★
                        </button>
                    {% endfor %}
                </div>
                <input type="hidden" name="rating" id="rating" value="3">  <!-- Default rating -->
            </div>
            <!-- Comment Box -->
            <textarea name="text" class="w-full p-2 rounded-lg bg-gray-700 text-white placeholder-gray-400" rows="4" placeholder="Write your comment..."></textarea>
            <button type="submit" class="mt-4 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Submit</button>
        </form>
    </div>
    {% else %}
        <p class="text-gray-400">You cannot comment on your own project.</p>
    {% endif %}

    <!-- Display Comments -->
    <div class="bg-gray-800 text-white rounded-lg shadow-lg p-6">
        <h3 class="text-xl font-bold mb-4">Comments</h3>
        {% for comment in project.comments.all %}
            <div class="mb-4 border-b border-gray-700 pb-4">
                <p class="text-gray-400">{{ comment.user.username }} - {{ comment.created_at }}</p>
                <div class="flex items-center mb-2">
                    <span class="mr-2">Rating:</span>
                    <div class="flex space-x-1">
                        {% for i in "12345" %}
                            <span class="{% if i|add:0 <= comment.rating %}text-yellow-400{% else %}text-gray-400{% endif %}">★</span>
                        {% endfor %}
                    </div>
                </div>
                <p>{{ comment.text }}</p>
            </div>
        {% empty %}
            <p>No comments yet.</p>
        {% endfor %}
    </div>
</div>

<!-- JavaScript for Star Rating -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const stars = document.querySelectorAll('.star-rating');
        const ratingInput = document.getElementById('rating');

        stars.forEach(star => {
            star.addEventListener('click', () => {
                const rating = star.getAttribute('data-rating');
                ratingInput.value = rating;

                // Update star colors
                stars.forEach((s, index) => {
                    if (index < rating) {
                        s.classList.add('text-yellow-400');
                        s.classList.remove('text-gray-400');
                    } else {
                        s.classList.add('text-gray-400');
                        s.classList.remove('text-yellow-400');
                    }
                });
            });
        });
    });
</script>
{% endblock %}